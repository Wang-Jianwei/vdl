
# è™šæ‹Ÿè®¾å¤‡å±‚ VDL è®¾è®¡æ–¹æ¡ˆ v2

ä¸€ã€å†å²é—®é¢˜æ€»ç»“
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å†å²é—®é¢˜ä¸æ•™è®­æ€»ç»“                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ã€è®¾è®¡ç¼ºé™·ã€‘                                                                â”‚
â”‚  â”œâ”€ Result ç±»å‹ä¸æ”¯æŒæ— é»˜è®¤æ„é€ å‡½æ•°çš„ç±»å‹                                     â”‚
â”‚  â”œâ”€ å•ä¸€çŠ¶æ€æšä¸¾æ··åˆå¤šä¸ªç»´åº¦ï¼ˆè¿æ¥/æ´»åŠ¨/å¥åº·ï¼‰å¯¼è‡´è¯­ä¹‰æ­§ä¹‰                      â”‚
â”‚  â”œâ”€ Transaction::commit() åªæ˜¯æ ‡å¿—ä½ï¼Œæ— å®é™…ä½œç”¨                              â”‚
â”‚  â”œâ”€ äº‹åŠ¡è·å–ç›´æ¥æŠ›å¼‚å¸¸ï¼Œå¤šçº¿ç¨‹ç«äº‰ä¸å‹å¥½                                       â”‚
â”‚  â””â”€ é©±åŠ¨æ¥å£è®¾è®¡æ— æ³•æ‰©å±•åˆ°PCIEå¤šé€šé“åœºæ™¯                                       â”‚
â”‚                                                                             â”‚
â”‚  ã€å®ç° Bugã€‘                                                                â”‚
â”‚  â”œâ”€ å¿ƒè·³è°ƒç”¨ markBusy() å¯¼è‡´è®¾å¤‡æ°¸è¿œå¤„äº Busy çŠ¶æ€                            â”‚
â”‚  â”œâ”€ execute() å¼‚å¸¸åˆ†æ”¯æœªæ¢å¤æ´»åŠ¨çŠ¶æ€                                          â”‚
â”‚  â”œâ”€ static constexpr ç±»å¤–å®šä¹‰ç¼ºå¤±å¯¼è‡´é“¾æ¥é”™è¯¯                                 â”‚
â”‚  â”œâ”€ åµŒå¥—ç»“æ„ä½“é»˜è®¤å‚æ•°åœ¨ C++11 ä¸‹ç¼–è¯‘å¤±è´¥                                     â”‚
â”‚  â””â”€ ç§»åŠ¨è¯­ä¹‰å¤„ç†ä¸å½“å¯¼è‡´ç¼–è¯‘é”™è¯¯                                              â”‚
â”‚                                                                             â”‚
â”‚  ã€æ¶æ„ä¸è¶³ã€‘                                                                â”‚
â”‚  â”œâ”€ ç¼ºä¹ç»Ÿä¸€çš„èµ„æºå¯»å€æ–¹å¼                                                   â”‚
â”‚  â”œâ”€ åè®®å±‚ä¸é©±åŠ¨å±‚è€¦åˆ                                                       â”‚
â”‚  â”œâ”€ ç¼ºä¹å®Œå–„çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†                                                   â”‚
â”‚  â”œâ”€ æ—¥å¿—å’Œç›‘æ§ä¸å¤Ÿå®Œå–„                                                       â”‚
â”‚  â””â”€ ç¼ºä¹é…ç½®ç®¡ç†æœºåˆ¶                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
äºŒã€é‡æ„ç›®æ ‡
text

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            é‡æ„ç›®æ ‡                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ¯ æ ¸å¿ƒç›®æ ‡                                                                 â”‚
â”‚  â”œâ”€ æ¥å£æ¸…æ™°ï¼šæ¯ä¸ªç±»/å‡½æ•°èŒè´£å•ä¸€æ˜ç¡®                                         â”‚
â”‚  â”œâ”€ ç±»å‹å®‰å…¨ï¼šç¼–è¯‘æœŸæ•è·æ›´å¤šé”™è¯¯                                              â”‚
â”‚  â”œâ”€ é›¶å¼€é”€æŠ½è±¡ï¼šä¸ä¸ºä¸ä½¿ç”¨çš„åŠŸèƒ½ä»˜å‡ºä»£ä»·                                       â”‚
â”‚  â”œâ”€ æ˜“äºæµ‹è¯•ï¼šä¾èµ–æ³¨å…¥ï¼Œä¾¿äº Mock                                            â”‚
â”‚  â””â”€ æ˜“äºæ‰©å±•ï¼šæ”¯æŒæ–°é€šä¿¡æ–¹å¼å’Œåè®®                                            â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“ è®¾è®¡åŸåˆ™                                                                 â”‚
â”‚  â”œâ”€ SOLID åŸåˆ™                                                              â”‚
â”‚  â”œâ”€ RAII èµ„æºç®¡ç†                                                           â”‚
â”‚  â”œâ”€ ç»„åˆä¼˜äºç»§æ‰¿                                                             â”‚
â”‚  â”œâ”€ æ¥å£éš”ç¦»                                                                 â”‚
â”‚  â””â”€ ä¾èµ–å€’ç½®                                                                 â”‚
â”‚                                                                             â”‚
â”‚  ğŸ”§ æŠ€æœ¯é€‰å‹                                                                 â”‚
â”‚  â”œâ”€ C++11 æ ¸å¿ƒè¯­æ³•                                                          â”‚
â”‚  â”œâ”€ tl::expected / tl::optional (ç¬¬ä¸‰æ–¹åº“)                                  â”‚
â”‚  â”œâ”€ å•å¤´æ–‡ä»¶æ—¥å¿—åº“ (spdlog)                                                  â”‚
â”‚  â””â”€ æ—  Boost ä¾èµ–                                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## ä¸€ã€æ ¸å¿ƒæ¥å£å®šä¹‰

### 1.1 ä¼ è¾“å±‚æ¥å£ (ITransport)

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `open` | - | `Res<void>` | æ‰“å¼€è¿æ¥ |
| `close` | - | `Res<void>` | å…³é—­è¿æ¥ |
| `isOpen` | - | `bool` | è¿æ¥çŠ¶æ€ |
| `write` | `data`, `timeout` | `Res<size_t>` | å†™å…¥æ•°æ® |
| `read` | `buffer`, `timeout` | `Res<size_t>` | è¯»å–æ•°æ® |
| `flush` | - | `Res<void>` | åˆ·æ–°ç¼“å†² |

### 1.2 ç¼–è§£ç å™¨æ¥å£ (ICodec)

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `encode` | `Command` | `Res<Bytes>` | å‘½ä»¤â†’å­—èŠ‚æµ |
| `decode` | `Bytes` | `Res<Response>` | å­—èŠ‚æµâ†’å“åº” |
| `frameSize` | `header` | `Res<size_t>` | æ ¹æ®å¤´éƒ¨æ¨æ–­å¸§é•¿ |

### 1.3 è®¾å¤‡æ¥å£ (IDevice)

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `connect` | - | `Res<void>` | å»ºç«‹è¿æ¥ |
| `disconnect` | - | `Res<void>` | æ–­å¼€è¿æ¥ |
| `state` | - | `DeviceState` | å½“å‰çŠ¶æ€ |
| `execute` | `cmd`, `timeout` | `Res<Response>` | æ‰§è¡Œå‘½ä»¤(è‡ªåŠ¨åŠ é”) |
| `tryLock` | - | `Optional<DeviceGuard>` | å°è¯•è·å–ç‹¬å  |
| `lock` | `timeout` | `Res<DeviceGuard>` | ç­‰å¾…è·å–ç‹¬å  |

---

## äºŒã€çŠ¶æ€è®¾è®¡

### 2.1 è®¾å¤‡çŠ¶æ€ (DeviceState)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŠ¶æ€          æè¿°               å¯æ‰§è¡Œæ“ä½œ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Created      åˆå§‹çŠ¶æ€            connect                        â”‚
â”‚  Connecting   è¿æ¥ä¸­              (ç­‰å¾…)                          â”‚
â”‚  Connected    å·²è¿æ¥ç©ºé—²          execute, lock, disconnect       â”‚
â”‚  Busy         å‘½ä»¤æ‰§è¡Œä¸­          (ç­‰å¾…å®Œæˆ)                       â”‚
â”‚  Disconnected å·²æ–­å¼€              connect                        â”‚
â”‚  Error        é”™è¯¯çŠ¶æ€            reset, connect                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 çŠ¶æ€è½¬æ¢å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Created â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚
        â”‚                â”‚ connect()      â”‚ reset()
        â”‚                â–¼                â”‚
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
        â”‚          â”‚Connecting â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–º Error
        â”‚          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ (å¤±è´¥)   â”‚
        â”‚                â”‚ (æˆåŠŸ)         â”‚
        â”‚                â–¼                â”‚
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
   disconnect()    â”‚ Connected â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ (å¼‚å¸¸)
        â”‚                â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    â”‚ execute() â”‚           â”‚ lock()
        â”‚    â–¼           â”‚           â–¼
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â””â”€â”‚ Busy â”‚â—„â”€â”€â”€â”€â”€â”€â”˜      â”‚ (Locked)â”‚ (é€»è¾‘çŠ¶æ€,éæšä¸¾)
          â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚ (å®Œæˆ)                â”‚ guardææ„
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Connected â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Busy çŠ¶æ€ç­–ç•¥

| åœºæ™¯ | Busy è¡Œä¸º | è¯´æ˜ |
|------|-----------|------|
| æ™®é€š execute | è¿›å…¥ Busy â†’ æ‰§è¡Œ â†’ æ¢å¤ Connected | é˜»å¡å…¶ä»–è°ƒç”¨ |
| Guard å†… execute | ä¸æ”¹å˜çŠ¶æ€ | å·²ç»ç‹¬å  |
| å¿ƒè·³æ£€æµ‹ | ä¸æ ‡è®° Busy | é¿å…å†å² bug |

---

## ä¸‰ã€ç‹¬å è®¿é—®è®¾è®¡ (DeviceGuard)

### 3.1 è®¾è®¡è¦ç‚¹

| è¦ç‚¹ | è¯´æ˜ |
|------|------|
| è¯­ä¹‰ | ç‹¬å è®¿é—®å®ˆå«ï¼Œéæ•°æ®åº“äº‹åŠ¡ |
| è·å–æ–¹å¼ | `tryLock()` ç«‹å³è¿”å› / `lock(timeout)` ç­‰å¾… |
| é‡Šæ”¾ | ææ„è‡ªåŠ¨é‡Šæ”¾ï¼Œå¯æ˜¾å¼ `release()` |
| å›æ»š | å¯é€‰ï¼Œç”¨æˆ·è‡ªè¡Œå¤„ç† |
| åµŒå¥— | ä¸æ”¯æŒï¼ŒåŒçº¿ç¨‹é‡å¤è·å–è¿”å›å¤±è´¥ |

### 3.2 ä¸å¿ƒè·³çš„åè°ƒ

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `pauseDuringLock` | `true` | ç‹¬å æœŸé—´æš‚åœå¿ƒè·³ |
| `heartbeatTimeout` | 500ms | å¿ƒè·³ç­‰å¾…ç‹¬å çš„è¶…æ—¶ |

---

## å››ã€é”™è¯¯ç±»å‹ä½“ç³»

### 4.1 é”™è¯¯ç åˆ†æ®µ

| èŒƒå›´ | ç±»åˆ« | ç¤ºä¾‹ |
|------|------|------|
| 0 | æˆåŠŸ | Ok |
| 100-199 | ä¼ è¾“å±‚ | ConnectionFailed, Timeout, ReadError |
| 200-299 | åè®®å±‚ | InvalidFrame, ChecksumError |
| 300-399 | è®¾å¤‡å±‚ | NotConnected, Busy, LockConflict |
| 400-499 | é€»è¾‘å±‚ | InvalidArgument, InvalidState |

### 4.2 Error å¯¹è±¡

| æˆå‘˜ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `code` | `ErrorCode` | é”™è¯¯ç  |
| `category` | `ErrorCategory` | é”™è¯¯ç±»åˆ«(ç”± code æ¨å¯¼) |
| `message` | `string` | æè¿°ä¿¡æ¯ |
| `context` | `string` | ä¸Šä¸‹æ–‡(å¯é“¾å¼æ·»åŠ ) |

---

## äº”ã€çº¿ç¨‹æ¨¡å‹

### 5.1 é€‰å®šæ–¹æ¡ˆï¼šè°ƒç”¨çº¿ç¨‹ + å¿ƒè·³çº¿ç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   User Thread 1 â”€â”€â”¬â”€â”€ execute() â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                   â”‚                 â”‚          â”‚           â”‚
â”‚   User Thread 2 â”€â”€â”¼â”€â”€ lock() â”€â”€â”€â”€â”€â–º â”‚  Device  â”‚â—„â”€â”€ mutex  â”‚
â”‚                   â”‚                 â”‚          â”‚           â”‚
â”‚   User Thread 3 â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                          â”‚                 â”‚
â”‚                                          â–¼                 â”‚
â”‚   Heartbeat Thread â—„â”€â”€â”€â”€â”€ pauseFlag â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 çº¿ç¨‹å®‰å…¨è¾¹ç•Œ

| ç»„ä»¶ | çº¿ç¨‹å®‰å…¨ | è¯´æ˜ |
|------|----------|------|
| Device | âœ… æ˜¯ | å†…éƒ¨ mutex ä¿æŠ¤ |
| DeviceGuard | âŒ å¦ | å•çº¿ç¨‹æŒæœ‰ |
| Transport | âŒ å¦ | ç”± Device ä¿æŠ¤ |
| Codec | âœ… æ˜¯ | æ— çŠ¶æ€æˆ–å†…éƒ¨åŒæ­¥ |

---

## å…­ã€å¿ƒè·³è®¾è®¡

### 6.1 é…ç½®é¡¹

| é…ç½® | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `interval` | ms | 1000 | å¿ƒè·³é—´éš” |
| `timeout` | ms | 500 | å•æ¬¡è¶…æ—¶ |
| `maxFailures` | int | 3 | è¿ç»­å¤±è´¥é˜ˆå€¼ |
| `pauseDuringLock` | bool | true | ç‹¬å æ—¶æš‚åœ |

### 6.2 å¿ƒè·³ç­–ç•¥æ¥å£

| ç­–ç•¥ | ç”¨é€” |
|------|------|
| SimpleHeartbeat | å›ºå®šæ¢æµ‹åŒ… + æœŸæœ›å“åº” |
| ScpiHeartbeat | SCPI å‘½ä»¤å¦‚ `*IDN?` |
| EchoHeartbeat | å›æ˜¾æ ¡éªŒ |
| è‡ªå®šä¹‰ | å®ç° IHeartbeatStrategy |

---

## ä¸ƒã€URI è®¾è®¡ (ç²¾ç®€)

### MVP æ”¯æŒ

| Scheme | æ ¼å¼ | ç¤ºä¾‹ |
|--------|------|------|
| tcp | `tcp://host:port` | `tcp://192.168.1.100:5025` |
| mock | `mock://name` | `mock://test?latency=10` |

### åç»­æ‰©å±•

| Scheme | æ ¼å¼ |
|--------|------|
| pcie | `pcie://BDF?channel=0,1` |
| serial | `serial:///dev/ttyUSB0?baud=115200` |
| usb | `usb://VID:PID` |

---

## å…«ã€ç›®å½•ç»“æ„ (ç²¾ç®€)

```
vdl/
â”œâ”€â”€ include/vdl/
â”‚   â”œâ”€â”€ core/           # Result, Span, Error, ScopeGuard
â”‚   â”œâ”€â”€ transport/      # ITransport, TcpTransport, MockTransport
â”‚   â”œâ”€â”€ protocol/       # ICodec, BinaryCodec
â”‚   â”œâ”€â”€ device/         # IDevice, DeviceImpl, DeviceGuard, Heartbeat
â”‚   â”œâ”€â”€ resource/       # Uri, UriParser
â”‚   â””â”€â”€ vdl.hpp
â”œâ”€â”€ src/
â”œâ”€â”€ tests/
â””â”€â”€ examples/
```

---

## ä¹ã€å¼€å‘è®¡åˆ’ (ä¿®è®¢)

| é˜¶æ®µ | å†…å®¹ | æ—¶é—´ |
|------|------|------|
| **P0: Spike** | TcpTransport + æœ€ç®€ Device åŸå‹ | 1å‘¨ |
| **P1: åŸºç¡€** | core/, Error, Uri | 2å‘¨ |
| **P2: ä¼ è¾“** | ITransport, Tcp, Mock | 2å‘¨ |
| **P3: åè®®** | ICodec, Binary | 1å‘¨ |
| **P4: è®¾å¤‡** | Device, Guard, Heartbeat | 4å‘¨ |
| **P5: é›†æˆ** | ç¤ºä¾‹, æ–‡æ¡£, æµ‹è¯• | 2å‘¨ |
| **åˆè®¡** | MVP å®Œæˆ | **12å‘¨** |

---

## åã€å¾…å†³ç­–é¡¹

| é—®é¢˜ | é€‰é¡¹ | å»ºè®® |
|------|------|------|
| Guard è·å–å¤±è´¥æ—¶è¡Œä¸º | A. è¿”å›ç©º B. è¿”å›é”™è¯¯ | tryLockâ†’A, lockâ†’B |
| å¿ƒè·³å¤±è´¥æ˜¯å¦è‡ªåŠ¨é‡è¿ | A. æ˜¯ B. å¦,åªä¸ŠæŠ¥ | B, è®©ä¸Šå±‚å†³ç­– |
| æ˜¯å¦æ”¯æŒå¼‚æ­¥ API | A. Phase1æ”¯æŒ B. åç»­ | B |
| Codec æ˜¯å¦æ„ŸçŸ¥ Transport | A. æ˜¯ B. å¦,çº¯æ•°æ® | B |

# VDL å®Œæ•´ç›®å½•ç»“æ„ v2

```
vdl/
â”‚
â”œâ”€â”€ include/vdl/
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                           # â•â•â•â•â•â• æ ¸å¿ƒåŸºç¡€è®¾æ–½ â•â•â•â•â•â•
â”‚   â”‚   â”œâ”€â”€ types.hpp                   # åŸºç¡€ç±»å‹: Bytes, Milliseconds, Span
â”‚   â”‚   â”œâ”€â”€ result.hpp                  # Res<T> = tl::expected<T, Error>
â”‚   â”‚   â”œâ”€â”€ error.hpp                   # Error, ErrorCode, ErrorCategory
â”‚   â”‚   â”œâ”€â”€ scope_guard.hpp             # ScopeGuard, RAII å·¥å…·
â”‚   â”‚   â”œâ”€â”€ noncopyable.hpp             # NonCopyable, NonMovable åŸºç±»
â”‚   â”‚   â”œâ”€â”€ string_utils.hpp            # å­—ç¬¦ä¸²å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ compat.hpp                  # C++11 å…¼å®¹: make_unique, enable_if_t
â”‚   â”‚   â””â”€â”€ log.hpp                     # spdlog åŒ…è£…å® (VDL_LOG_INFO ç­‰)
â”‚   â”‚
â”‚   â”œâ”€â”€ resource/                       # â•â•â•â•â•â• èµ„æºå¯»å€ â•â•â•â•â•â•
â”‚   â”‚   â”œâ”€â”€ uri.hpp                     # Uri ç±»å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ uri_parser.hpp              # URI è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ uri_builder.hpp             # URI æ„å»ºå™¨
â”‚   â”‚   â””â”€â”€ query_params.hpp            # æŸ¥è¯¢å‚æ•°è§£æ
â”‚   â”‚
â”‚   â”œâ”€â”€ transport/                      # â•â•â•â•â•â• ä¼ è¾“å±‚ â•â•â•â•â•â•
â”‚   â”‚   â”œâ”€â”€ transport.hpp               # ITransport æ¥å£
â”‚   â”‚   â”œâ”€â”€ transport_factory.hpp       # ä¼ è¾“å±‚å·¥å‚
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tcp/
â”‚   â”‚   â”‚   â”œâ”€â”€ tcp_transport.hpp       # TCP ä¼ è¾“å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ tcp_config.hpp          # TCP é…ç½®
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ mock/
â”‚   â”‚   â”‚   â”œâ”€â”€ mock_transport.hpp      # Mock ä¼ è¾“(æµ‹è¯•ç”¨)
â”‚   â”‚   â”‚   â””â”€â”€ mock_script.hpp         # Mock è„šæœ¬(é¢„è®¾å“åº”)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ serial/                     # [Phase 2]
â”‚   â”‚   â”‚   â”œâ”€â”€ serial_transport.hpp
â”‚   â”‚   â”‚   â””â”€â”€ serial_config.hpp
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ pcie/                       # [Phase 2]
â”‚   â”‚   â”‚   â”œâ”€â”€ pcie_transport.hpp
â”‚   â”‚   â”‚   â”œâ”€â”€ pcie_channel.hpp
â”‚   â”‚   â”‚   â”œâ”€â”€ pcie_config.hpp
â”‚   â”‚   â”‚   â””â”€â”€ dma_buffer.hpp
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ usb/                        # [Phase 2]
â”‚   â”‚       â”œâ”€â”€ usb_transport.hpp
â”‚   â”‚       â””â”€â”€ usb_config.hpp
â”‚   â”‚
â”‚   â”œâ”€â”€ protocol/                       # â•â•â•â•â•â• åè®®å±‚ â•â•â•â•â•â•
â”‚   â”‚   â”œâ”€â”€ codec.hpp                   # ICodec æ¥å£
â”‚   â”‚   â”œâ”€â”€ frame.hpp                   # Frame å¸§ç»“æ„
â”‚   â”‚   â”œâ”€â”€ command.hpp                 # Command å‘½ä»¤å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ response.hpp                # Response å“åº”å®šä¹‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ binary/
â”‚   â”‚   â”‚   â”œâ”€â”€ binary_codec.hpp        # äºŒè¿›åˆ¶åè®®ç¼–è§£ç 
â”‚   â”‚   â”‚   â””â”€â”€ binary_frame.hpp        # äºŒè¿›åˆ¶å¸§æ ¼å¼
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ scpi/                       # [å¯é€‰]
â”‚   â”‚       â”œâ”€â”€ scpi_codec.hpp          # SCPI åè®®ç¼–è§£ç 
â”‚   â”‚       â””â”€â”€ scpi_parser.hpp         # SCPI è§£æå™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ device/                         # â•â•â•â•â•â• è®¾å¤‡å±‚ â•â•â•â•â•â•
â”‚   â”‚   â”œâ”€â”€ device_state.hpp            # DeviceState æšä¸¾
â”‚   â”‚   â”œâ”€â”€ device_config.hpp           # DeviceConfig é…ç½®
â”‚   â”‚   â”œâ”€â”€ device.hpp                  # IDevice æ¥å£
â”‚   â”‚   â”œâ”€â”€ device_impl.hpp             # Device å®ç°
â”‚   â”‚   â”œâ”€â”€ device_guard.hpp            # DeviceGuard ç‹¬å å®ˆå«
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ heartbeat/
â”‚   â”‚       â”œâ”€â”€ heartbeat_config.hpp    # HeartbeatConfig é…ç½®
â”‚   â”‚       â”œâ”€â”€ heartbeat_strategy.hpp  # IHeartbeatStrategy æ¥å£
â”‚   â”‚       â”œâ”€â”€ heartbeat_runner.hpp    # HeartbeatRunner åå°çº¿ç¨‹
â”‚   â”‚       â””â”€â”€ strategies/
â”‚   â”‚           â”œâ”€â”€ simple_heartbeat.hpp    # ç®€å•æ¢æµ‹
â”‚   â”‚           â”œâ”€â”€ echo_heartbeat.hpp      # å›æ˜¾æ£€æµ‹
â”‚   â”‚           â””â”€â”€ scpi_heartbeat.hpp      # SCPI *IDN? æ£€æµ‹
â”‚   â”‚
â”‚   â”œâ”€â”€ manager/                        # â•â•â•â•â•â• è®¾å¤‡ç®¡ç† â•â•â•â•â•â•
â”‚   â”‚   â”œâ”€â”€ device_factory.hpp          # è®¾å¤‡å·¥å‚
â”‚   â”‚   â”œâ”€â”€ device_registry.hpp         # è®¾å¤‡æ³¨å†Œè¡¨
â”‚   â”‚   â””â”€â”€ device_manager.hpp          # è®¾å¤‡ç®¡ç†å™¨(å¯é€‰)
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                         # â•â•â•â•â•â• é…ç½®ç®¡ç† â•â•â•â•â•â•
â”‚   â”‚   â”œâ”€â”€ config_types.hpp            # é…ç½®ç»“æ„ä½“å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ config_loader.hpp           # é…ç½®åŠ è½½æ¥å£
â”‚   â”‚   â””â”€â”€ json_config.hpp             # JSON é…ç½® (åŸºäº nlohmann/json)
â”‚   â”‚
â”‚   â””â”€â”€ vdl.hpp                         # ç»Ÿä¸€å¤´æ–‡ä»¶
â”‚
â”œâ”€â”€ src/                                # â•â•â•â•â•â• å®ç°æ–‡ä»¶ â•â•â•â•â•â•
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ error.cpp
â”‚   â”‚   â””â”€â”€ string_utils.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ resource/
â”‚   â”‚   â”œâ”€â”€ uri.cpp
â”‚   â”‚   â””â”€â”€ uri_parser.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ transport/
â”‚   â”‚   â”œâ”€â”€ transport_factory.cpp
â”‚   â”‚   â”œâ”€â”€ tcp/
â”‚   â”‚   â”‚   â””â”€â”€ tcp_transport.cpp
â”‚   â”‚   â””â”€â”€ mock/
â”‚   â”‚       â””â”€â”€ mock_transport.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ protocol/
â”‚   â”‚   â””â”€â”€ binary/
â”‚   â”‚       â””â”€â”€ binary_codec.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ device/
â”‚   â”‚   â”œâ”€â”€ device_impl.cpp
â”‚   â”‚   â”œâ”€â”€ device_guard.cpp
â”‚   â”‚   â””â”€â”€ heartbeat/
â”‚   â”‚       â””â”€â”€ heartbeat_runner.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ manager/
â”‚   â”‚   â””â”€â”€ device_factory.cpp
â”‚   â”‚
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ json_config.cpp
â”‚
â”œâ”€â”€ tests/                              # â•â•â•â•â•â• æµ‹è¯•ä»£ç  â•â•â•â•â•â•
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ test_result.cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ test_error.cpp
â”‚   â”‚   â”‚   â””â”€â”€ test_scope_guard.cpp
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ resource/
â”‚   â”‚   â”‚   â””â”€â”€ test_uri_parser.cpp
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ transport/
â”‚   â”‚   â”‚   â”œâ”€â”€ test_tcp_transport.cpp
â”‚   â”‚   â”‚   â””â”€â”€ test_mock_transport.cpp
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ protocol/
â”‚   â”‚   â”‚   â””â”€â”€ test_binary_codec.cpp
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ device/
â”‚   â”‚   â”‚   â”œâ”€â”€ test_device_state.cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ test_device_guard.cpp
â”‚   â”‚   â”‚   â””â”€â”€ test_heartbeat.cpp
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ config/
â”‚   â”‚       â””â”€â”€ test_json_config.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ test_device_lifecycle.cpp
â”‚   â”‚   â”œâ”€â”€ test_concurrent_access.cpp
â”‚   â”‚   â””â”€â”€ test_heartbeat_recovery.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ mocks/
â”‚   â”‚   â”œâ”€â”€ mock_transport.hpp
â”‚   â”‚   â”œâ”€â”€ mock_codec.hpp
â”‚   â”‚   â””â”€â”€ mock_heartbeat_strategy.hpp
â”‚   â”‚
â”‚   â””â”€â”€ test_main.cpp
â”‚
â”œâ”€â”€ examples/                           # â•â•â•â•â•â• ç¤ºä¾‹ä»£ç  â•â•â•â•â•â•
â”‚   â”œâ”€â”€ 01_basic_connection/
â”‚   â”‚   â”œâ”€â”€ main.cpp
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ 02_device_guard/
â”‚   â”‚   â”œâ”€â”€ main.cpp
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ 03_heartbeat/
â”‚   â”‚   â”œâ”€â”€ main.cpp
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ 04_custom_protocol/
â”‚   â”‚   â”œâ”€â”€ main.cpp
â”‚   â”‚   â”œâ”€â”€ my_codec.hpp
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â””â”€â”€ 05_multi_device/
â”‚       â”œâ”€â”€ main.cpp
â”‚       â”œâ”€â”€ devices.json                # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”‚       â””â”€â”€ README.md
â”‚
â”œâ”€â”€ third_party/                        # â•â•â•â•â•â• ç¬¬ä¸‰æ–¹åº“ â•â•â•â•â•â•
â”‚   â”œâ”€â”€ tl_expected/
â”‚   â”‚   â””â”€â”€ expected.hpp
â”‚   â”‚
â”‚   â”œâ”€â”€ tl_optional/
â”‚   â”‚   â””â”€â”€ optional.hpp
â”‚   â”‚
â”‚   â”œâ”€â”€ spdlog/                         # æ—¥å¿—åº“ (header-only æˆ– submodule)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ nlohmann_json/                  # JSON åº“ (header-only)
â”‚   â”‚   â””â”€â”€ json.hpp
â”‚   â”‚
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ design/
â”‚   â”‚   â”œâ”€â”€ architecture.md
â”‚   â”‚   â”œâ”€â”€ state_machine.md
â”‚   â”‚   â”œâ”€â”€ threading_model.md
â”‚   â”‚   â””â”€â”€ error_handling.md
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ (Doxygen ç”Ÿæˆ)
â”‚   â”‚
â”‚   â””â”€â”€ guides/
â”‚       â”œâ”€â”€ getting_started.md
â”‚       â”œâ”€â”€ custom_transport.md
â”‚       â””â”€â”€ custom_protocol.md
â”‚
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ format.sh
â”‚   â””â”€â”€ generate_docs.sh
â”‚
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ cmake/
â”‚   â”œâ”€â”€ VdlConfig.cmake.in
â”‚   â”œâ”€â”€ CompilerOptions.cmake
â”‚   â””â”€â”€ FindDependencies.cmake          # æŸ¥æ‰¾/ä¸‹è½½ç¬¬ä¸‰æ–¹åº“
â”‚
â”œâ”€â”€ .clang-format
â”œâ”€â”€ .gitignore
â”œâ”€â”€ LICENSE
â””â”€â”€ README.md
```

---

## å˜æ›´è¯´æ˜

| å˜æ›´é¡¹ | æ—§æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|--------|--------|--------|
| æ—¥å¿—ç³»ç»Ÿ | è‡ªç ” `log/` ç›®å½• | spdlog + åŒ…è£…å® (`core/log.hpp`) |
| JSON è§£æ | å¯é€‰è‡ªç ” | nlohmann/json |
| æ—¥å¿— sink | 3 ä¸ªè‡ªç ” sink | spdlog å†…ç½® sink |
| æ–‡ä»¶æ•°é‡ | ~50 | ~45 (å‡å°‘çº¦ 10%) |

---

## ç¬¬ä¸‰æ–¹åº“é›†æˆæ–¹å¼

| åº“ | æ¨èæ–¹å¼ | å¤‡é€‰ |
|---|----------|------|
| spdlog | git submodule | CMake FetchContent |
| nlohmann/json | å•å¤´æ–‡ä»¶å¤åˆ¶ | CMake FetchContent |
| tl::expected | å•å¤´æ–‡ä»¶å¤åˆ¶ | - |
| tl::optional | å•å¤´æ–‡ä»¶å¤åˆ¶ | - |

---

## core/log.hpp è¯´æ˜

```cpp
// ç®€å•åŒ…è£…ï¼Œç»Ÿä¸€æ—¥å¿—æ¥å£ï¼Œä¾¿äºæœªæ¥æ›¿æ¢

#pragma once
#include <spdlog/spdlog.h>

#define VDL_LOG_TRACE(...)    SPDLOG_TRACE(__VA_ARGS__)
#define VDL_LOG_DEBUG(...)    SPDLOG_DEBUG(__VA_ARGS__)
#define VDL_LOG_INFO(...)     SPDLOG_INFO(__VA_ARGS__)
#define VDL_LOG_WARN(...)     SPDLOG_WARN(__VA_ARGS__)
#define VDL_LOG_ERROR(...)    SPDLOG_ERROR(__VA_ARGS__)
#define VDL_LOG_CRITICAL(...) SPDLOG_CRITICAL(__VA_ARGS__)

namespace vdl {
    // å¯é€‰ï¼šåˆå§‹åŒ–å‡½æ•°
    void initLogging(spdlog::level::level_enum level = spdlog::level::info);
}
```

---

## æ–‡ä»¶æ•°é‡ç»Ÿè®¡ (æ›´æ–°)

| ç›®å½• | æ–‡ä»¶æ•° | è¯´æ˜ |
|------|--------|------|
| `include/vdl/core/` | 8 | å« log.hpp |
| `include/vdl/resource/` | 4 | URI å¤„ç† |
| `include/vdl/transport/` | 4 + 6 (æ‰©å±•) | ä¼ è¾“å±‚ |
| `include/vdl/protocol/` | 4 + 2 | åè®®å±‚ |
| `include/vdl/device/` | 5 + 5 | è®¾å¤‡å±‚ |
| `include/vdl/manager/` | 3 | è®¾å¤‡ç®¡ç† |
| `include/vdl/config/` | 3 | é…ç½®ç®¡ç† |
| `src/` | ~12 | å®ç°æ–‡ä»¶ |
| `tests/` | ~15 | æµ‹è¯•æ–‡ä»¶ |
| **æ€»è®¡ (MVP)** | **~45** | ä¸å«æ‰©å±•ä¼ è¾“ |


# VDL è¯¦ç»†å¼€å‘è®¡åˆ’

```
================================================================================
                               å¼€å‘é˜¶æ®µæ€»è§ˆ
================================================================================

Phase 01   é¡¹ç›®éª¨æ¶                 1å¤©
Phase 02   ç¬¬ä¸‰æ–¹åº“é›†æˆ             1å¤©
Phase 03   æµ‹è¯•æ¡†æ¶                 1å¤©
Phase 04   å…¼å®¹å±‚                   1å¤©
Phase 05   åŸºç¡€ç±»å‹                 1å¤©
Phase 06   æ—¥å¿—å°è£…                 1å¤©
Phase 07   é”™è¯¯ç å®šä¹‰               1å¤©
Phase 08   é”™è¯¯ç±»å®ç°               1å¤©
Phase 09   Resultç±»å‹               1å¤©
Phase 10   ä½œç”¨åŸŸå®ˆå«               1å¤©
Phase 11   å­—ç¬¦ä¸²å·¥å…·               1å¤©
Phase 12   URIç±»å®šä¹‰                1å¤©
Phase 13   æŸ¥è¯¢å‚æ•°è§£æ             1å¤©
Phase 14   URIè§£æå™¨                1å¤©
Phase 15   URIæ„å»ºå™¨                1å¤©
Phase 16   ä¼ è¾“å±‚æ¥å£               1å¤©
Phase 17   TCPé…ç½®                  1å¤©
Phase 18   TCPè¿æ¥ç®¡ç†              1å¤©
Phase 19   TCPè¯»å†™å®ç°              2å¤©
Phase 20   Mockè„šæœ¬                 1å¤©
Phase 21   Mockä¼ è¾“å®ç°             1å¤©
Phase 22   ä¼ è¾“å±‚å·¥å‚               1å¤©
Phase 23   å‘½ä»¤ä¸å“åº”               1å¤©
Phase 24   ç¼–è§£ç æ¥å£               1å¤©
Phase 25   äºŒè¿›åˆ¶å¸§æ ¼å¼             1å¤©
Phase 26   äºŒè¿›åˆ¶ç¼–ç                1å¤©
Phase 27   äºŒè¿›åˆ¶è§£ç                1å¤©
Phase 28   è®¾å¤‡çŠ¶æ€æšä¸¾             1å¤©
Phase 29   çŠ¶æ€è½¬æ¢é€»è¾‘             1å¤©
Phase 30   è®¾å¤‡é…ç½®                 1å¤©
Phase 31   è®¾å¤‡æ¥å£                 1å¤©
Phase 32   è®¾å¤‡è¿æ¥ç®¡ç†             1å¤©
Phase 33   è®¾å¤‡å‘½ä»¤æ‰§è¡Œ             2å¤©
Phase 34   è®¾å¤‡å®ˆå«å®šä¹‰             1å¤©
Phase 35   è®¾å¤‡å®ˆå«å®ç°             1å¤©
Phase 36   è®¾å¤‡é”æœºåˆ¶               1å¤©
Phase 37   å¹¶å‘è®¿é—®æµ‹è¯•             1å¤©
Phase 38   å¿ƒè·³é…ç½®                 1å¤©
Phase 39   å¿ƒè·³ç­–ç•¥æ¥å£             1å¤©
Phase 40   å¿ƒè·³ç­–ç•¥å®ç°             1å¤©
Phase 41   å¿ƒè·³è¿è¡Œå™¨å®šä¹‰           1å¤©
Phase 42   å¿ƒè·³è¿è¡Œå™¨å®ç°           2å¤©
Phase 43   å¿ƒè·³é›†æˆæµ‹è¯•             1å¤©
Phase 44   è®¾å¤‡æ³¨å†Œè¡¨               1å¤©
Phase 45   è®¾å¤‡å·¥å‚                 1å¤©
Phase 46   é…ç½®ç±»å‹å®šä¹‰             1å¤©
Phase 47   JSONé…ç½®åŠ è½½             1å¤©
Phase 48   è®¾å¤‡ç®¡ç†å™¨               1å¤©
Phase 49   ç»Ÿä¸€å¤´æ–‡ä»¶               1å¤©
Phase 50   ç¤ºä¾‹01-02                1å¤©
Phase 51   ç¤ºä¾‹03-04                1å¤©
Phase 52   ç¤ºä¾‹05                   1å¤©
Phase 53   ä½¿ç”¨æ–‡æ¡£                 1å¤©
Phase 54   é¡¹ç›®æ”¶å°¾                 1å¤©

--------------------------------------------------------------------------------
æ€»è®¡: 58 å·¥ä½œæ—¥ (çº¦ 12 å‘¨)
--------------------------------------------------------------------------------


================================================================================
Phase 01: é¡¹ç›®éª¨æ¶ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    CMakeLists.txt
    cmake/CompilerOptions.cmake
    .gitignore
    .clang-format


================================================================================
Phase 02: ç¬¬ä¸‰æ–¹åº“é›†æˆ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    cmake/FindDependencies.cmake
    third_party/tl_expected/expected.hpp
    third_party/tl_optional/optional.hpp
    third_party/README.md


================================================================================
Phase 03: æµ‹è¯•æ¡†æ¶ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    third_party/spdlog/...
    third_party/nlohmann_json/json.hpp
    tests/CMakeLists.txt
    tests/test_main.cpp


================================================================================
Phase 04: å…¼å®¹å±‚ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/compat.hpp
    tests/unit/core/test_compat.cpp


================================================================================
Phase 05: åŸºç¡€ç±»å‹ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/noncopyable.hpp
    include/vdl/core/types.hpp
    tests/unit/core/test_types.cpp


================================================================================
Phase 06: æ—¥å¿—å°è£… (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/log.hpp
    tests/unit/core/test_log.cpp


================================================================================
Phase 07: é”™è¯¯ç å®šä¹‰ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/error_code.hpp
    tests/unit/core/test_error_code.cpp


================================================================================
Phase 08: é”™è¯¯ç±»å®ç° (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/error.hpp
    src/core/error.cpp
    tests/unit/core/test_error.cpp


================================================================================
Phase 09: Resultç±»å‹ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/result.hpp
    tests/unit/core/test_result.cpp


================================================================================
Phase 10: ä½œç”¨åŸŸå®ˆå« (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/scope_guard.hpp
    tests/unit/core/test_scope_guard.cpp


================================================================================
Phase 11: å­—ç¬¦ä¸²å·¥å…· (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/core/string_utils.hpp
    src/core/string_utils.cpp
    tests/unit/core/test_string_utils.cpp


================================================================================
Phase 12: URIç±»å®šä¹‰ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/resource/uri.hpp
    src/resource/uri.cpp
    tests/unit/resource/test_uri.cpp


================================================================================
Phase 13: æŸ¥è¯¢å‚æ•°è§£æ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/resource/query_params.hpp
    src/resource/query_params.cpp
    tests/unit/resource/test_query_params.cpp


================================================================================
Phase 14: URIè§£æå™¨ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/resource/uri_parser.hpp
    src/resource/uri_parser.cpp
    tests/unit/resource/test_uri_parser.cpp


================================================================================
Phase 15: URIæ„å»ºå™¨ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/resource/uri_builder.hpp
    tests/unit/resource/test_uri_builder.cpp


================================================================================
Phase 16: ä¼ è¾“å±‚æ¥å£ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/transport/transport.hpp


================================================================================
Phase 17: TCPé…ç½® (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/transport/tcp/tcp_config.hpp
    tests/unit/transport/test_tcp_config.cpp


================================================================================
Phase 18: TCPè¿æ¥ç®¡ç† (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/transport/tcp/tcp_transport.hpp
    src/transport/tcp/tcp_transport.cpp (è¿æ¥éƒ¨åˆ†)


================================================================================
Phase 19: TCPè¯»å†™å®ç° (2å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    src/transport/tcp/tcp_transport.cpp (è¯»å†™éƒ¨åˆ†)
    tests/unit/transport/test_tcp_transport.cpp


================================================================================
Phase 20: Mockè„šæœ¬ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/transport/mock/mock_script.hpp
    tests/unit/transport/test_mock_script.cpp


================================================================================
Phase 21: Mockä¼ è¾“å®ç° (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/transport/mock/mock_transport.hpp
    src/transport/mock/mock_transport.cpp
    tests/unit/transport/test_mock_transport.cpp


================================================================================
Phase 22: ä¼ è¾“å±‚å·¥å‚ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/transport/transport_factory.hpp
    src/transport/transport_factory.cpp
    tests/unit/transport/test_transport_factory.cpp


================================================================================
Phase 23: å‘½ä»¤ä¸å“åº” (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/protocol/command.hpp
    include/vdl/protocol/response.hpp
    tests/unit/protocol/test_command_response.cpp


================================================================================
Phase 24: ç¼–è§£ç æ¥å£ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/protocol/frame.hpp
    include/vdl/protocol/codec.hpp


================================================================================
Phase 25: äºŒè¿›åˆ¶å¸§æ ¼å¼ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/protocol/binary/binary_frame.hpp
    tests/unit/protocol/test_binary_frame.cpp


================================================================================
Phase 26: äºŒè¿›åˆ¶ç¼–ç  (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/protocol/binary/binary_codec.hpp
    src/protocol/binary/binary_codec.cpp (ç¼–ç éƒ¨åˆ†)


================================================================================
Phase 27: äºŒè¿›åˆ¶è§£ç  (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    src/protocol/binary/binary_codec.cpp (è§£ç éƒ¨åˆ†)
    tests/unit/protocol/test_binary_codec.cpp


================================================================================
Phase 28: è®¾å¤‡çŠ¶æ€æšä¸¾ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/device_state.hpp
    tests/unit/device/test_device_state.cpp


================================================================================
Phase 29: çŠ¶æ€è½¬æ¢é€»è¾‘ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    src/device/device_state.cpp
    tests/unit/device/test_state_transition.cpp


================================================================================
Phase 30: è®¾å¤‡é…ç½® (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/device_config.hpp
    tests/unit/device/test_device_config.cpp


================================================================================
Phase 31: è®¾å¤‡æ¥å£ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/device.hpp


================================================================================
Phase 32: è®¾å¤‡è¿æ¥ç®¡ç† (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/device_impl.hpp
    src/device/device_impl.cpp (è¿æ¥éƒ¨åˆ†)


================================================================================
Phase 33: è®¾å¤‡å‘½ä»¤æ‰§è¡Œ (2å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    src/device/device_impl.cpp (æ‰§è¡Œéƒ¨åˆ†)
    tests/unit/device/test_device_impl.cpp


================================================================================
Phase 34: è®¾å¤‡å®ˆå«å®šä¹‰ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/device_guard.hpp


================================================================================
Phase 35: è®¾å¤‡å®ˆå«å®ç° (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    src/device/device_guard.cpp
    tests/unit/device/test_device_guard.cpp


================================================================================
Phase 36: è®¾å¤‡é”æœºåˆ¶ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    src/device/device_impl.cpp (é”éƒ¨åˆ†)
    tests/unit/device/test_device_lock.cpp


================================================================================
Phase 37: å¹¶å‘è®¿é—®æµ‹è¯• (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    tests/integration/test_concurrent_access.cpp


================================================================================
Phase 38: å¿ƒè·³é…ç½® (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/heartbeat/heartbeat_config.hpp
    tests/unit/device/test_heartbeat_config.cpp


================================================================================
Phase 39: å¿ƒè·³ç­–ç•¥æ¥å£ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/heartbeat/heartbeat_strategy.hpp


================================================================================
Phase 40: å¿ƒè·³ç­–ç•¥å®ç° (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/heartbeat/strategies/simple_heartbeat.hpp
    include/vdl/device/heartbeat/strategies/echo_heartbeat.hpp
    include/vdl/device/heartbeat/strategies/scpi_heartbeat.hpp
    tests/unit/device/test_heartbeat_strategy.cpp


================================================================================
Phase 41: å¿ƒè·³è¿è¡Œå™¨å®šä¹‰ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/device/heartbeat/heartbeat_runner.hpp


================================================================================
Phase 42: å¿ƒè·³è¿è¡Œå™¨å®ç° (2å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    src/device/heartbeat/heartbeat_runner.cpp
    tests/unit/device/test_heartbeat_runner.cpp


================================================================================
Phase 43: å¿ƒè·³é›†æˆæµ‹è¯• (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    tests/integration/test_heartbeat_recovery.cpp


================================================================================
Phase 44: è®¾å¤‡æ³¨å†Œè¡¨ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/manager/device_registry.hpp
    tests/unit/manager/test_device_registry.cpp


================================================================================
Phase 45: è®¾å¤‡å·¥å‚ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/manager/device_factory.hpp
    src/manager/device_factory.cpp
    tests/unit/manager/test_device_factory.cpp


================================================================================
Phase 46: é…ç½®ç±»å‹å®šä¹‰ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/config/config_types.hpp
    include/vdl/config/config_loader.hpp
    tests/unit/config/test_config_types.cpp


================================================================================
Phase 47: JSONé…ç½®åŠ è½½ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/config/json_config.hpp
    src/config/json_config.cpp
    tests/unit/config/test_json_config.cpp


================================================================================
Phase 48: è®¾å¤‡ç®¡ç†å™¨ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/manager/device_manager.hpp
    src/manager/device_manager.cpp
    tests/unit/manager/test_device_manager.cpp


================================================================================
Phase 49: ç»Ÿä¸€å¤´æ–‡ä»¶ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    include/vdl/vdl.hpp
    tests/integration/test_device_lifecycle.cpp


================================================================================
Phase 50: ç¤ºä¾‹01-02 (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    examples/01_basic_connection/main.cpp
    examples/01_basic_connection/README.md
    examples/02_device_guard/main.cpp
    examples/02_device_guard/README.md


================================================================================
Phase 51: ç¤ºä¾‹03-04 (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    examples/03_heartbeat/main.cpp
    examples/03_heartbeat/README.md
    examples/04_custom_protocol/main.cpp
    examples/04_custom_protocol/my_codec.hpp
    examples/04_custom_protocol/README.md


================================================================================
Phase 52: ç¤ºä¾‹05 (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    examples/05_multi_device/main.cpp
    examples/05_multi_device/devices.json
    examples/05_multi_device/README.md


================================================================================
Phase 53: ä½¿ç”¨æ–‡æ¡£ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    docs/guides/getting_started.md
    docs/guides/custom_transport.md
    docs/guides/custom_protocol.md


================================================================================
Phase 54: é¡¹ç›®æ”¶å°¾ (1å¤©)
================================================================================

äº§å‡ºæ–‡ä»¶:
    README.md
    LICENSE


================================================================================
                               ä¾èµ–å…³ç³»å›¾
================================================================================

P01 â”€â”€ P02 â”€â”€ P03
              â”‚
              â–¼
P04 â”€â”€ P05 â”€â”€ P06
              â”‚
              â–¼
P07 â”€â”€ P08 â”€â”€ P09 â”€â”€ P10 â”€â”€ P11
                             â”‚
                             â–¼
P12 â”€â”€ P13 â”€â”€ P14 â”€â”€ P15
                     â”‚
                     â–¼
              P16 â”€â”€ P17 â”€â”€ P18 â”€â”€ P19
                                   â”‚
              P20 â”€â”€ P21 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                   â”‚
                                   â–¼
                                  P22
                                   â”‚
P23 â”€â”€ P24 â”€â”€ P25 â”€â”€ P26 â”€â”€ P27   â”‚
                             â”‚     â”‚
                             â–¼     â–¼
                     P22 + P27 â”€â”€â”€â”€â”´â”€â”€â”€â–º P28 â”€â”€ P29
                                               â”‚
P30 â”€â”€ P31 â”€â”€ P32 â”€â”€ P33 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
P34 â”€â”€ P35 â”€â”€ P36 â”€â”€ P37
                     â”‚
                     â–¼
P38 â”€â”€ P39 â”€â”€ P40 â”€â”€ P41 â”€â”€ P42 â”€â”€ P43
                                   â”‚
                                   â–¼
              P44 â”€â”€ P45 â”€â”€ P46 â”€â”€ P47 â”€â”€ P48 â”€â”€ P49
                                               â”‚
                                               â–¼
                           P50 â”€â”€ P51 â”€â”€ P52 â”€â”€ P53 â”€â”€ P54


================================================================================
                               æ£€æŸ¥ç‚¹æ±‡æ€»
================================================================================

P03 ç»“æŸ    é¡¹ç›®å¯ç¼–è¯‘, æµ‹è¯•æ¡†æ¶å¯ç”¨
P11 ç»“æŸ    core æ¨¡å—å®Œæˆ
P15 ç»“æŸ    resource æ¨¡å—å®Œæˆ
P22 ç»“æŸ    transport æ¨¡å—å®Œæˆ
P27 ç»“æŸ    protocol æ¨¡å—å®Œæˆ
P37 ç»“æŸ    device æ ¸å¿ƒ + ç‹¬å è®¿é—®å®Œæˆ
P43 ç»“æŸ    heartbeat å®Œæˆ
P49 ç»“æŸ    manager + config å®Œæˆ
P54 ç»“æŸ    v1.0 å‘å¸ƒå°±ç»ª


================================================================================
                              æ–‡ä»¶ç»Ÿè®¡æ±‡æ€»
================================================================================

ç›®å½•                              æ–‡ä»¶æ•°
-----------------------------------------
include/vdl/core/                 8
include/vdl/resource/             4
include/vdl/transport/            6
include/vdl/protocol/             6
include/vdl/device/               10
include/vdl/manager/              3
include/vdl/config/               3
include/vdl/                      1
src/                              13
tests/unit/                       32
tests/integration/                4
examples/                         11
docs/                             3
æ ¹ç›®å½•                            5
-----------------------------------------
æ€»è®¡                              109
```
